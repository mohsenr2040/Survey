@using Staff_Survey.ViewModel
@model SurveyViewModel

@{
    ViewData["Title"] = "CreateSurvey";
    Layout = "~/Views/Shared/_MyLayout.cshtml";
}
@*@using Staff_Survey.Models.Entities*@

<section class="basic-elements">


    <!-- Details -->
    <div class="form-control">
        <label for="Name" id="label-name">
            عنوان نظرسنجی
        </label>

        <!-- Input Type Text -->
        <input type="text" id="SurveyName" placeholder="عنوان نظرسنجی را وارد نمایید" />
    </div>


    <!-- Multi-line Text Input Control -->
    <a class="a-button" onclick="AddNewSurvey()">ثبت</a>

     <div style="border: 1px solid #564040; margin: 10px auto;">

        <table id="tbl_Survey" class="table-custom">
        <thead >
            <tr style="width:100%; ">
                <th style="width:60%;   text-align: center;">عنوان</th>
                <th style="width:10%"></th>
                <th style="width:10%"></th>
                <th style="width:10%"></th>
                <th style="width:10%"></th>
            </tr>
   
        </thead>
        <tbody>
            @foreach (var item in Model.Surveys)
            {
                <tr>
                    <td>
                        @item.name
                    </td>
                    <td>
                        <a class="removebutton" Id="btnDeleteSurvey" onclick="DeleteSurvey(@item.Id)"> حذف  </a>
                    </td>
                        <td>
                            <a class="removebutton" Id="btnDisplay" onclick="DisplaySurvey(@item.Id)">  
                                @if(@item.Display)
                                { <p>عدم نمایش</p>} else {<p> نمایش</p> } </a>
                     </td>
                     <td>
                            <a href="">انتخاب چندگزینه</a>
                        </td>
                     <td>
                         <a href="~/survey/ShowSurveyResult?surveyId=@item.Id" style="text-decoration:none">نمایش نتیجه</a>
                     </td>
                </tr>
            }
        </tbody>
    </table>
    </div>
</section>


@section Scripts
{

    <link href="~/Sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <script src="~/Sweetalert2/sweetalert2.min.js"></script>


    <script>

        function AddNewSurvey() {


            var inputd = document.getElementById("SurveyName");
            if (inputd.value == '') {


                swal.fire({
                    title: 'ایجاد نظرسنجی',
                    text: "!عنوان نظرسنجی را وارد نمایید",
                    icon: 'warning',
                    confirmButtonColor: '#da7957',
                    confirmButtonText: 'OK ',
                })
                return false;
            }

            swal.fire({
                title: 'ایجاد نظرسنجی',
                text: "آیا میخواهید نظرسنجی جدید به لیست دسته بندی ها اضافه شود؟",
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'بله، اضافه شود',
                cancelButtonText: 'خیر'
            }).then((result) => {

                if (result.value) {
                    var Name = $("#SurveyName").val();
                    $("#SurveyName").val("");

                    var postData = {
                        'SurveyName': Name,
                    };

                    $.ajax({
                        contentType: 'application/x-www-form-urlencoded',
                        dataType: 'json',
                        type: "POST",
                        url: "CreateSurvey",
                        data: postData,
                        success: function (data) {
                            if (data.isSuccess == true) {
                                swal.fire(
                                    'موفق!',
                                    data.message,
                                    'success'
                                ).then(function (isConfirm) {
                                    location.reload();
                                });


                            }
                            else {

                                swal.fire(
                                    'هشدار!',
                                    data.message,
                                    'warning'
                                );

                            }
                        },
                        error: function (request, status, error) {
                            swal.fire(
                                'هشدار!',
                                request.responseText,
                                'warning'
                            );
                        }

                    });

                }

            })
        }

        function DeleteSurvey(SurveyId) {
            swal.fire({
                title: 'حذف نظرسنجی',
                text: "کاربر گرامی از حذف مطمئن هستید؟",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#7cacbe',
                confirmButtonText: 'بله ، حذف شود',
                cancelButtonText: 'خیر'
            }).then((result) => {
                if (result.value) {
                    var postData = {
                        'surveyId': SurveyId,
                    };
                    $.ajax({
                        contentType: 'application/x-www-form-urlencoded',
                        dataType: 'json',
                        type: "POST",
                        url: "DeleteSurvey",
                        data: postData,

                        success: function (data) {
                            if (data.isSuccess == true) {
                                swal.fire(
                                    'موفق!',
                                    data.message,
                                    'success'
                                ).then(function (isConfirm) {
                                    location.reload();
                                });
                            }
                            else {

                                swal.fire(
                                    'هشدار!',
                                    data.message,
                                    'warning'
                                );

                            }
                        },
                        error: function (request, status, error) {
                            alert(request.responseText);
                        }

                    });

                }
            })
        }

        function DisplaySurvey(SurveyId) {
        swal.fire({
            title: 'عدم / نمایش نظرسنجی',
            text: "کاربر گرامی آیا مطمئن هستید؟",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#7cacbe',
            confirmButtonText: 'بله ، عدم / نمایش شود',
            cancelButtonText: 'خیر'
        }).then((result) => {
            if (result.value) {
                var postData = {
                    'surveyId': SurveyId,
                };
                $.ajax({
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: 'json',
                    type: "POST",
                    url: "DisplaySurvey",
                    data: postData,

                    success: function (data) {
                        if (data.isSuccess == true) {
                            swal.fire(
                                'موفق!',
                                data.message,
                                'success'
                            ).then(function (isConfirm) {
                                location.reload();
                            });
                        }
                        else {

                            swal.fire(
                                'هشدار!',
                                data.message,
                                'warning'
                            );

                        }
                    },
                    error: function (request, status, error) {
                        alert(request.responseText);
                    }

                });

            }
        })
    }

    </script>
}